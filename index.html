<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frontline London Staff Portal</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Global Styles */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      color: #333;
    }
    .container {
      display: flex;
      min-height: 100vh;
    }
    /* Sidebar Styling */
    .sidebar {
      width: 250px;
      background: #0044ff; /* Updated color */
      color: #fff;
      padding: 20px;
      box-sizing: border-box;
      min-height: 100vh;
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin-top: 20px;
    }
    .sidebar ul li {
      margin-bottom: 15px;
    }
    .sidebar ul li a {
      display: block;
      padding: 10px 15px;
      background-color: #444;
      border-radius: 5px;
      text-decoration: none;
      color: #fff;
      transition: background-color 0.2s ease;
    }
    .sidebar ul li a:hover {
      background-color: #555;
    }
    /* Dashboard & Header Styling */
    .dashboard {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
    }
    .dashboard-header {
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .dashboard-header h1 {
      margin: 0 0 10px;
    }
    /* Section Styling */
    section {
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    section h2 {
      margin-top: 0;
      margin-bottom: 15px;
    }
    /* Resources Section (unchanged) */
    .resources .resource-list {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .resources .resource {
      flex: 1 1 220px;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .resources .resource img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 5px;
    }
    .resources .resource h3 {
      margin: 10px 0;
    }
    .resources .resource p {
      font-size: 0.9em;
      margin-bottom: 15px;
    }
    .resources .resource button {
      padding: 10px 20px;
      background-color: #007bff;
      border: none;
      color: #fff;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.2s ease;
    }
    .resources .resource button:hover {
      background-color: #0056b3;
    }
    /* Moderation Actions Section */
    .moderation-actions {
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .moderation-actions h2 {
      margin-top: 0;
      margin-bottom: 15px;
    }
    .moderation-actions form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }
    .moderation-actions form input,
    .moderation-actions form select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    .moderation-actions form button {
      padding: 10px 20px;
      background-color: #c0392b;
      border: none;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }
    .moderation-actions form button:hover {
      background-color: #a93226;
    }
    #modResult {
      font-weight: bold;
    }
    /* Login Overlay Styles */
    #auth-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    #auth-overlay .login-box {
      background: #fff;
      padding: 40px;
      border-radius: 10px;
      text-align: center;
    }
    #auth-overlay button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    #auth-overlay button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <!-- Login Overlay -->
  <div id="auth-overlay">
    <div class="login-box">
      <h2>Staff Login</h2>
      <button id="discord-login">Login with Discord</button>
    </div>
  </div>

  <!-- Main Portal Container (Hidden until logged in) -->
  <div id="main-container" class="container" style="display: none;">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <h2>Frontline London</h2>
      <ul>
        <li><a href="index.html" class="active">Home</a></li>
        <li><a href="moderation.html">Moderation</a></li>
        <li><a href="resources.html">Resources</a></li>
        <li><a href="suggestion.html">Staff Suggestions</a></li>
        <li><a href="#" id="logout">Logout</a></li>
      </ul>
    </aside>

    <!-- Main Dashboard Area -->
    <main class="dashboard">
      <header class="dashboard-header">
        <h1>Frontline London Staff Portal</h1>
        <p>Welcome back to the portal. Stay updated with the latest staff notices, events, and resources.</p>
      </header>
      
      <!-- Existing content sections (Notices, Resources, etc.) -->
      <section class="notices">
        <h2>About the Staff Portal</h2>
        <article>
          <h3>Information about the FLSP</h3>
          <p>The Frontline London Staff Portal (FLSP) is the one stop shop for all things staff! Through this system, you can review advisory documents, make suggestions for the community, and send out kicks and bans!</p>
        </article>
      </section>
      
      <section class="notices">
        <h2>Staff Notices</h2>
        <article>
          <h3>It's Release Day!!</h3>
          <p>Today marks a huge moment for all of us. After weeks of hard work, Frontline London officially opens its doors to the public. Thank you for being part of this journey!</p>
        </article>
      </section>
      
      <section class="resources">
        <h2>Useful Links & Resources</h2>
        <div class="resource-list">
          <div class="resource">
            <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxISEBAQEBAQEBAPDw8QDxAPEBAPDw8NFREWFhUVFRUYHSggGBolJxUVITIhJSkrLzAuGB8zODMsNygtLisBCgoKDg0OFxAQGy0fHyUrKy0tKy0tLS0tLS0tKy0tLS0tLS0tLS0tKy0tLS8tLS0tLS0tLS0tLS0tLS0tLS0tLf/AABEIAIUBewMBEQACEQEDEQH/xAAcAAACAwEBAQEAAAAAAAAAAAAAAQIDBAUGBwj/xABLEAACAgEDAwIEBAMGBwAAAAAAAQIDBBEhMQUSQVEGEyJhcYGRBxQjMjNywfAVFjNSYnKxFLH/xAAaAQADAQEBAQAAAAAAAAAAAAAAAQIDBAUG/8QAJBEAAgIBAwQCAwEAAAAAAAAAAAECEQMhEjFBEzJRYQUUInH/2gAMAwEAAhEDEQA/APyKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABbWlUot3anhw9GxPp7fl/BpXjfmuh9PSexXp007zmm2x0+3c7DxmN+acu1VbVeadbV67VY41Jm03XN1ycZJ/NI1LXzRUvYo4FYvJYlDJifpLS3y/TjsNDdPYXXt1/kl16NitdnZG80HMY3z2Z745vDrpby9Vfqcwzumt0XKHcmrea56/OyqyWtXksuJWpMaNdK1tEnSnx+PPnmsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADJdnPDcL8B2i1HRsOkfumm3n/AKedNpZsq/UKNZWLnOlKSe6aOpIqPpXj7J6r1Ja0Yp3Tq/cUXjFrCPI08XFGmbT+Pq2v3rdUorucm6mKnJtKrNEspJc62uLSz1cl+p+S6ZYdRzjnPPBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIC6c3GcVITb5po/SUl2nTvdjT4f/write remainder here (truncated for brevity)...">
            <h3>txAdmin</h3>
            <p>Access the txAdmin portal</p>
            <button onclick="window.open('http://109.106.1.99:40120/', '_blank')">Visit txAdmin</button>
          </div>
          <div class="resource">
            <img src="https://media.discordapp.net/attachments/1367230490851147936/1382892634464583680/Frontline_London_Twitter_Banner.png?ex=684ccea0&is=684b7d20&hm=40d00a64df1f0394a57216f2c6adfb644db3771c29e615bf4dcdcf577a8e09e1&format=webp&quality=lossless" alt="FMS">
            <h3>FMS</h3>
            <p>Access the Force Management System portal.</p>
            <button onclick="window.open('https://frontlinelondonrpc.forcemanagementsystem.com/portal', '_blank')">Visit FMS</button>
          </div>
        </div>
      </section>
      
      <!-- Moderation Actions Section -->
      <section class="moderation-actions">
        <h2>Moderation Actions</h2>
        
        <!-- Ban User Form -->
        <form id="banForm">
          <h3>Ban User Request</h3>
          <input type="text" id="banUserId" placeholder="Enter Discord User ID" required>
          <input type="text" id="banReason" placeholder="Reason for ban" required>
          <input type="text" id="banStaffDetails" placeholder="Requesting Staff Member's details" required>
          <input type="text" id="banEvidence" placeholder="Proof/Evidence (link or description)" required>
          <button type="submit">Submit Ban Request</button>
        </form>
        
        <!-- Kick User Form -->
        <form id="kickForm">
          <h3>Kick User Request</h3>
          <input type="text" id="kickUserId" placeholder="Enter Discord User ID" required>
          <input type="text" id="kickReason" placeholder="Reason for kick" required>
          <input type="text" id="kickStaffDetails" placeholder="Requesting Staff Member's details" required>
          <input type="text" id="kickEvidence" placeholder="Proof/Evidence (link or description)" required>
          <button type="submit">Submit Kick Request</button>
        </form>
        
        <!-- Action Log Form for In-Game Actions -->
        <form id="actionLogForm">
          <h3>In-Game Action Log</h3>
          <select id="actionType" required>
            <option value="" disabled selected>Select Action Type</option>
            <option value="Kick">Kick</option>
            <option value="Ban">Ban</option>
            <option value="Warning">Warning</option>
          </select>
          <input type="text" id="actionUserId" placeholder="Enter In-Game User ID" required>
          <input type="text" id="actionReason" placeholder="Reason for action" required>
          <input type="text" id="actionStaffDetails" placeholder="Staff Member details" required>
          <input type="text" id="actionEvidence" placeholder="Proof/Evidence (link or description)" required>
          <button type="submit">Submit Action Log</button>
        </form>
        
        <p id="modResult"></p>
      </section>
    </main>
  </div>
  
  <script>
    /* ---------- Discord OAuth Login Integration ---------- */
    const CLIENT_ID = "1382882140764770304"; // Replace with your Discord Client ID
    const REDIRECT_URI = "https://cbincorporated.github.io/Frontline-London/"; // Replace with your actual redirect URI registered with Discord

    // Show login overlay if user is not logged in
    function checkLogin() {
      const user = localStorage.getItem("discordUser");
      if (user) {
        document.getElementById("auth-overlay").style.display = "none";
        document.getElementById("main-container").style.display = "flex";
      } else {
        document.getElementById("auth-overlay").style.display = "flex";
        document.getElementById("main-container").style.display = "none";
      }
    }
    checkLogin();

    document.getElementById("discord-login").addEventListener("click", function() {
      window.location.href = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;
    });

    // Process access token if returned in URL hash
    function processToken() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      const accessToken = params.get("access_token");
      if (accessToken) {
        fetch("https://discord.com/api/users/@me", {
          headers: { Authorization: `Bearer ${accessToken}` }
        })
        .then(response => response.json())
        .then(data => {
          localStorage.setItem("discordUser", data.username);
          // Clean URL hash and show portal
          window.location.hash = "";
          checkLogin();
        })
        .catch(error => console.error("Error fetching Discord user:", error));
      }
    }
    processToken();

    document.getElementById("logout").addEventListener("click", function() {
      localStorage.removeItem("discordUser");
      window.location.reload();
    });

    /* ---------- Moderation Webhook Integration ---------- */
    // Webhook URL for moderation requests (Ban & Kick)
    const moderationWebhook = "https://discord.com/api/webhooks/1382887377902502129/R6OEY-RXWZ5DO4F1CdJJVV9q0ZdqdolVCE4_F678ewfW-3__34H5T-VO7Aa4oOvZ1Yds";
    // Webhook URL for Action Log (In-Game actions)
    const actionLogWebhook = "https://discord.com/api/webhooks/1382881344941588520/smBbOMsZF5g8vis2b4M0tv3inJNMT2Ma1gbj8Nl1KN74d3xfAAcvMI722d9xJBnTxB71";

    async function sendDiscordEmbed(webhook, embedPayload) {
      const payload = {
        username: "Frontline London Moderation Approval",
        avatar_url: "https://frontlinelondonrpc.forcemanagementsystem.com/images/logo.png",
        embeds: [embedPayload]
      };
      try {
        const response = await fetch(webhook, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        return response.ok;
      } catch (error) {
        console.error("Error sending embed:", error);
        return false;
      }
    }

    // Ban Form Submission
    document.getElementById("banForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const userId = document.getElementById("banUserId").value.trim();
      const reason = document.getElementById("banReason").value.trim();
      const staffDetails = document.getElementById("banStaffDetails").value.trim();
      const evidence = document.getElementById("banEvidence").value.trim();

      if (!userId || !reason || !staffDetails || !evidence) {
        document.getElementById("modResult").innerText = "All fields are required for a ban request.";
        return;
      }

      const embedPayload = {
        title: "Ban Request",
        description: `**User ID:** ${userId}\n**Reason:** ${reason}\n**Staff Details:** ${staffDetails}\n**Proof/Evidence:** ${evidence}`,
        color: 15158332,  // Red for bans
        footer: { text: "Request sent to moderation channel." },
        timestamp: new Date().toISOString()
      };

      const success = await sendDiscordEmbed(moderationWebhook, embedPayload);
      document.getElementById("modResult").innerText = success ? "Ban request sent successfully." : "Error sending ban request.";
      document.getElementById("banForm").reset();
    });

    // Kick Form Submission
    document.getElementById("kickForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const userId = document.getElementById("kickUserId").value.trim();
      const reason = document.getElementById("kickReason").value.trim();
      const staffDetails = document.getElementById("kickStaffDetails").value.trim();
      const evidence = document.getElementById("kickEvidence").value.trim();

      if (!userId || !reason || !staffDetails || !evidence) {
        document.getElementById("modResult").innerText = "All fields are required for a kick request.";
        return;
      }

      const embedPayload = {
        title: "Kick Request",
        description: `**User ID:** ${userId}\n**Reason:** ${reason}\n**Staff Details:** ${staffDetails}\n**Proof/Evidence:** ${evidence}`,
        color: 15105570,  // Orange for kicks
        footer: { text: "Request sent to moderation channel." },
        timestamp: new Date().toISOString()
      };

      const success = await sendDiscordEmbed(moderationWebhook, embedPayload);
      document.getElementById("modResult").innerText = success ? "Kick request sent successfully." : "Error sending kick request.";
      document.getElementById("kickForm").reset();
    });

    // Action Log Form Submission (for in-game actions)
    document.getElementById("actionLogForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const type = document.getElementById("actionType").value;
      const userId = document.getElementById("actionUserId").value.trim();
      const reason = document.getElementById("actionReason").value.trim();
      const staffDetails = document.getElementById("actionStaffDetails").value.trim();
      const evidence = document.getElementById("actionEvidence").value.trim();

      if (!type || !userId || !reason || !staffDetails || !evidence) {
        document.getElementById("modResult").innerText = "All fields are required for an action log.";
        return;
      }

      const embedPayload = {
        title: `In-Game Action: ${type}`,
        description: `**User ID:** ${userId}\n**Action Type:** ${type}\n**Reason:** ${reason}\n**Staff Details:** ${staffDetails}\n**Proof/Evidence:** ${evidence}`,
        color: type === "Ban" ? 15158332 : type === "Kick" ? 15105570 : 3447003,
        timestamp: new Date().toISOString()
      };

      const success = await sendDiscordEmbed(actionLogWebhook, embedPayload);
      document.getElementById("modResult").innerText = success ? "Action log sent successfully." : "Error sending action log.";
      document.getElementById("actionLogForm").reset();
    });
  </script>
</body>
</html>
